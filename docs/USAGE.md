# ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç» PixivFlow çš„æ‰€æœ‰åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚

---

## ğŸš€ åŸºæœ¬ä½¿ç”¨

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœé€šè¿‡ `npm install -g pixivflow` å…¨å±€å®‰è£…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `pixivflow` å‘½ä»¤ã€‚å¦‚æœä»æºç å®‰è£…ï¼Œè¯·ä½¿ç”¨ `npm run` å‘½ä»¤ã€‚

### æ‰§è¡Œä¸€æ¬¡ä¸‹è½½

**å…¨å±€å®‰è£…æ–¹å¼**ï¼š
```bash
pixivflow download
```

**æºç å®‰è£…æ–¹å¼**ï¼š
```bash
npm run download
```

æˆ–ä½¿ç”¨è„šæœ¬ï¼š

```bash
./scripts/pixiv.sh once
```

### éšæœºä¸‹è½½ï¼ˆå¿«é€Ÿä½“éªŒï¼‰

**å…¨å±€å®‰è£…æ–¹å¼**ï¼š
```bash
# éšæœºä¸‹è½½æ’ç”»
pixivflow random

# éšæœºä¸‹è½½å°è¯´
pixivflow random --novel
```

**æºç å®‰è£…æ–¹å¼**ï¼š
```bash
# éšæœºä¸‹è½½æ’ç”»
npm run random

# éšæœºä¸‹è½½å°è¯´
npm run random -- --novel
```

### å¯åŠ¨å®šæ—¶ä»»åŠ¡

**å…¨å±€å®‰è£…æ–¹å¼**ï¼š
```bash
pixivflow scheduler
```

**æºç å®‰è£…æ–¹å¼**ï¼š
```bash
npm run scheduler
```

æˆ–ä½¿ç”¨è„šæœ¬ï¼š

```bash
./scripts/pixiv.sh run
```

---

## ğŸ“¥ ä¸‹è½½åŠŸèƒ½

### æ’ç”»ä¸‹è½½

æ’ç”»ä¼šä¿å­˜ä¸ºå›¾ç‰‡æ–‡ä»¶ï¼Œæ”¯æŒå¤šé¡µå›¾ç‰‡ã€‚

**é…ç½®ç¤ºä¾‹**ï¼š

```json
{
  "targets": [
    {
      "type": "illustration",
      "tag": "é¢¨æ™¯",
      "limit": 20
    }
  ]
}
```

### å°è¯´ä¸‹è½½

å°è¯´ä¼šä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼ˆ.txtï¼‰ï¼ŒåŒ…å«æ ‡é¢˜ã€ä½œè€…ã€æ ‡ç­¾ç­‰ä¿¡æ¯ã€‚

**é…ç½®ç¤ºä¾‹**ï¼š

```json
{
  "targets": [
    {
      "type": "novel",
      "tag": "å°èª¬",
      "limit": 10
    }
  ]
}
```

### å¤šæ ‡ç­¾æœç´¢

æ”¯æŒå¤šä¸ªæ ‡ç­¾åŒæ—¶æœç´¢ï¼Œæ ‡ç­¾ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ï¼š

```json
{
  "targets": [
    {
      "type": "illustration",
      "tag": "æ˜æ—¥æ–¹èˆŸ ã‚¢ãƒ¼ã‚¯ãƒŠã‚¤ãƒ„ ã‚¢ãƒ¼ãƒŸãƒ¤",
      "tagRelation": "and",
      "limit": 30
    }
  ]
}
```

**æ ‡ç­¾å…³ç³»**ï¼š
- `"and"`ï¼šå¿…é¡»åŒæ—¶åŒ…å«æ‰€æœ‰æ ‡ç­¾ï¼ˆé»˜è®¤ï¼‰
- `"or"`ï¼šåŒ…å«ä»»æ„ä¸€ä¸ªæ ‡ç­¾å³å¯

### æ’è¡Œæ¦œä¸‹è½½

ä¸‹è½½æ’è¡Œæ¦œä½œå“ï¼š

```json
{
  "targets": [
    {
      "type": "illustration",
      "mode": "ranking",
      "rankingMode": "day",
      "rankingDate": "YESTERDAY",
      "limit": 10
    }
  ]
}
```

**æ’è¡Œæ¦œæ¨¡å¼**ï¼š
- `"day"`ï¼šæ—¥æ¦œ
- `"week"`ï¼šå‘¨æ¦œ
- `"month"`ï¼šæœˆæ¦œ
- `"day_male"`ï¼šç”·æ€§å‘æ—¥æ¦œ
- `"day_female"`ï¼šå¥³æ€§å‘æ—¥æ¦œ
- `"day_ai"`ï¼šAI æ—¥æ¦œ
- `"week_original"`ï¼šåŸåˆ›å‘¨æ¦œ
- `"week_rookie"`ï¼šæ–°äººå‘¨æ¦œ
- `"day_r18"`ï¼šR18 æ—¥æ¦œ
- `"day_male_r18"`ï¼šç”·æ€§å‘ R18 æ—¥æ¦œ
- `"day_female_r18"`ï¼šå¥³æ€§å‘ R18 æ—¥æ¦œ

### ç­›é€‰åŠŸèƒ½

#### æŒ‰æ”¶è—æ•°ç­›é€‰

```json
{
  "targets": [
    {
      "type": "illustration",
      "tag": "é¢¨æ™¯",
      "limit": 50,
      "minBookmarks": 1000,
      "sort": "popular_desc"
    }
  ]
}
```

#### æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰

```json
{
  "targets": [
    {
      "type": "illustration",
      "tag": "é¢¨æ™¯",
      "limit": 50,
      "startDate": "2024-01-01",
      "endDate": "2024-12-31",
      "sort": "date_desc"
    }
  ]
}
```

**æ³¨æ„**ï¼šä½¿ç”¨ `date_desc` æ’åºæ—¶ï¼Œé‡åˆ°æ™šäº `endDate` çš„ä½œå“ä¼šè·³è¿‡ä½†ç»§ç»­æœç´¢ï¼Œé‡åˆ°æ—©äº `startDate` çš„ä½œå“ä¼šåœæ­¢æœç´¢ã€‚

#### éšæœºé€‰æ‹©

```json
{
  "targets": [
    {
      "type": "illustration",
      "tag": "é¢¨æ™¯",
      "limit": 20,
      "random": true
    }
  ]
}
```

### å°è¯´ä¸“ç”¨åŠŸèƒ½

#### å°è¯´ç³»åˆ—ä¸‹è½½

```json
{
  "targets": [
    {
      "type": "novel",
      "seriesId": 14690617,
      "limit": 50
    }
  ]
}
```

#### å•ç¯‡å°è¯´ä¸‹è½½

```json
{
  "targets": [
    {
      "type": "novel",
      "novelId": 26132156
    }
  ]
}
```

#### è¯­è¨€è¿‡æ»¤

```json
{
  "targets": [
    {
      "type": "novel",
      "tag": "åŸç¥",
      "limit": 20,
      "languageFilter": "chinese",
      "detectLanguage": true
    }
  ]
}
```

**è¯­è¨€è¿‡æ»¤é€‰é¡¹**ï¼š
- `"chinese"`ï¼šä»…ä¸‹è½½ä¸­æ–‡å°è¯´
- `"non-chinese"`ï¼šä»…ä¸‹è½½éä¸­æ–‡å°è¯´
- ä¸è®¾ç½®ï¼šä¸‹è½½æ‰€æœ‰è¯­è¨€çš„å°è¯´

---

## â° å®šæ—¶ä»»åŠ¡

### å¯ç”¨å®šæ—¶ä»»åŠ¡

åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š

```json
{
  "scheduler": {
    "enabled": true,
    "cron": "0 3 * * *",
    "timezone": "Asia/Shanghai"
  }
}
```

### å¯åŠ¨å®šæ—¶ä»»åŠ¡

```bash
npm run scheduler
```

æˆ–ä½¿ç”¨è„šæœ¬ï¼š

```bash
./scripts/pixiv.sh run
```

### Cron è¡¨è¾¾å¼ç¤ºä¾‹

| è¡¨è¾¾å¼ | è¯´æ˜ |
|--------|------|
| `0 * * * *` | æ¯å°æ—¶æ‰§è¡Œ |
| `0 */6 * * *` | æ¯ 6 å°æ—¶æ‰§è¡Œ |
| `0 2 * * *` | æ¯å¤© 2:00 æ‰§è¡Œ |
| `0 0 * * 0` | æ¯å‘¨æ—¥ 0:00 æ‰§è¡Œ |
| `0 0 1 * *` | æ¯æœˆ 1 å· 0:00 æ‰§è¡Œ |

### åœæ­¢å®šæ—¶ä»»åŠ¡

```bash
./scripts/pixiv.sh stop
```

æˆ–æŒ‰ `Ctrl+C` åœæ­¢ã€‚

---

## ğŸ’¾ æ–‡ä»¶ç®¡ç†

### æŸ¥çœ‹ç›®å½•ä¿¡æ¯

ä½¿ç”¨ `dirs` å‘½ä»¤å¯ä»¥å¿«é€ŸæŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶ä¿å­˜ç›®å½•ï¼š

```bash
# æŸ¥çœ‹ç›®å½•ä¿¡æ¯
pixivflow dirs

# æŸ¥çœ‹è¯¦ç»†ç›®å½•ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç»å¯¹è·¯å¾„ã€æ˜¯å¦å­˜åœ¨ç­‰ï¼‰
pixivflow dirs --verbose
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ“ Directory Information

  Download Directory:     ./downloads
  Illustration Directory: ./downloads/illustrations
  Novel Directory:        ./downloads/novels
  Database Path:          ./data/pixiv-downloader.db
```

### é…ç½®ç›®å½•è·¯å¾„

ä½¿ç”¨ `config set` å‘½ä»¤å¯ä»¥å¿«é€Ÿè®¾ç½®ç›®å½•è·¯å¾„ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
# è®¾ç½®ä¸‹è½½ç›®å½•
pixivflow config set storage.downloadDirectory ./my-downloads

# è®¾ç½®æ’ç”»ç›®å½•
pixivflow config set storage.illustrationDirectory ./my-illustrations

# è®¾ç½®å°è¯´ç›®å½•
pixivflow config set storage.novelDirectory ./my-novels

# è®¾ç½®æ•°æ®åº“è·¯å¾„
pixivflow config set storage.databasePath ./data/my-db.db
```

**æç¤º**ï¼š
- ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ—¶ï¼Œç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•
- ä½¿ç”¨ç»å¯¹è·¯å¾„æ—¶ï¼Œç›´æ¥æŒ‡å®šå®Œæ•´è·¯å¾„
- è®¾ç½®åä¼šè‡ªåŠ¨å¤‡ä»½åŸé…ç½®æ–‡ä»¶
- å¯ä»¥ä½¿ç”¨ `pixivflow config show` æŸ¥çœ‹æ‰€æœ‰é…ç½®ï¼ˆåŒ…æ‹¬ç›®å½•è·¯å¾„ï¼‰

### è‡ªåŠ¨å»é‡

PixivFlow ä½¿ç”¨ SQLite æ•°æ®åº“è®°å½•å·²ä¸‹è½½çš„ä½œå“ï¼Œè‡ªåŠ¨è·³è¿‡é‡å¤ä¸‹è½½ã€‚

**æ•°æ®åº“ä½ç½®**ï¼š`data/pixiv-downloader.db`

### æ–­ç‚¹ç»­ä¼ 

ä¸‹è½½ä¸­æ–­åé‡æ–°è¿è¡Œï¼Œä¼šè‡ªåŠ¨ç»§ç»­ä¸‹è½½æœªå®Œæˆçš„ä½œå“ã€‚

### æ–‡ä»¶ç»„ç»‡

æ”¯æŒå¤šç§æ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼Œè¯¦è§ [é…ç½®æŒ‡å—](./CONFIG.md#ç›®å½•ç»„ç»‡æ–¹å¼)ã€‚

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### åŠ¨æ€å¹¶å‘è°ƒæ•´

å½“æ£€æµ‹åˆ°é€Ÿç‡é™åˆ¶ï¼ˆ429é”™è¯¯ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™ä½å¹¶å‘æ•°ï¼Œå¹¶åœ¨æˆåŠŸè¯·æ±‚åé€æ­¥æ¢å¤ã€‚

**é…ç½®**ï¼š

```json
{
  "download": {
    "concurrency": 3,
    "dynamicConcurrency": true,
    "minConcurrency": 1
  }
}
```

### é”™è¯¯å¤„ç†

PixivFlow å†…ç½®å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

- âœ… **è‡ªåŠ¨è·³è¿‡å·²åˆ é™¤ä½œå“**ï¼šå¦‚æœä½œå“å·²è¢«ä½œè€…åˆ é™¤ï¼Œä¼šè‡ªåŠ¨è·³è¿‡
- âœ… **è‡ªåŠ¨è·³è¿‡ç§æœ‰ä½œå“**ï¼šå¦‚æœä½œå“è®¾ç½®ä¸ºç§æœ‰ï¼Œä¼šè‡ªåŠ¨è·³è¿‡
- âœ… **è‡ªåŠ¨é‡è¯•**ï¼šä¸‹è½½å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼ˆå¯é…ç½®é‡è¯•æ¬¡æ•°ï¼‰
- âœ… **ä¸ä¼šä¸­æ–­æµç¨‹**ï¼šå•ä¸ªä½œå“ä¸‹è½½å¤±è´¥ä¸ä¼šå½±å“æ•´ä¸ªä¸‹è½½ä»»åŠ¡

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹è¿è¡Œæ—¥å¿—
./scripts/pixiv.sh logs

# æˆ–ç›´æ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f data/pixiv-downloader.log
```

**æ—¥å¿—çº§åˆ«**ï¼š
- `debug`ï¼šè¯¦ç»†è°ƒè¯•ä¿¡æ¯
- `info`ï¼šä¸€èˆ¬ä¿¡æ¯ï¼ˆé»˜è®¤ï¼‰
- `warn`ï¼šè­¦å‘Šä¿¡æ¯
- `error`ï¼šé”™è¯¯ä¿¡æ¯

---

## ğŸš€ æœåŠ¡å™¨éƒ¨ç½²

### ä½¿ç”¨ PM2 ç®¡ç†

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨å®šæ—¶ä»»åŠ¡
pm2 start "npm run scheduler" --name pixivflow

# ä¿å­˜ PM2 é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

### ä½¿ç”¨ systemd

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/pixivflow.service`ï¼š

```ini
[Unit]
Description=PixivFlow Automation Downloader
After=network.target

[Service]
Type=simple
User=your-username
WorkingDirectory=/path/to/pixivflow
ExecStart=/usr/bin/node dist/index.js scheduler
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl enable pixivflow
sudo systemctl start pixivflow
sudo systemctl status pixivflow
```

### ä½¿ç”¨ Docker

è¯¦è§ [Docker æŒ‡å—](./DOCKER.md)ã€‚

---

## â“ å¸¸è§é—®é¢˜

### æ‰¾ä¸åˆ°åŒ¹é…çš„ä½œå“ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
- æ ‡ç­¾æ‹¼å†™é”™è¯¯æˆ–ä¸å­˜åœ¨
- ç­›é€‰æ¡ä»¶è¿‡äºä¸¥æ ¼
- ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
1. å°è¯•å¸¸è§æ ‡ç­¾ï¼š`ã‚¤ãƒ©ã‚¹ãƒˆ`ã€`é¢¨æ™¯`ã€`art`
2. é™ä½ `minBookmarks` å€¼
3. æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®
4. åœ¨ Pixiv ç½‘ç«™ä¸Šæœç´¢ç¡®è®¤æ ‡ç­¾å­˜åœ¨

### ä¸‹è½½é€Ÿåº¦æ…¢æˆ–ç»å¸¸å¤±è´¥ï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. è°ƒæ•´ä¸‹è½½è®¾ç½®ï¼š
   - å‡å°‘ `download.concurrency`ï¼ˆä¾‹å¦‚è®¾ç½®ä¸º 1-2ï¼‰
   - å¢åŠ  `download.requestDelay`ï¼ˆä¾‹å¦‚ 1000-2000msï¼‰
   - ä¿æŒ `download.dynamicConcurrency: true`ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
3. å¢åŠ é‡è¯•æ¬¡æ•°å’Œè¶…æ—¶æ—¶é—´
4. ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰

### å®šæ—¶ä»»åŠ¡æ²¡æœ‰è¿è¡Œï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥é…ç½®ï¼šç¡®ä¿ `scheduler.enabled` ä¸º `true`
2. æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š`./scripts/pixiv.sh status`
3. æŸ¥çœ‹æ—¥å¿—ï¼š`./scripts/pixiv.sh logs`
4. ç¡®ä¿ç¨‹åºæŒç»­è¿è¡Œï¼ˆä½¿ç”¨ PM2 æˆ– systemdï¼‰

### é‡åˆ°å·²åˆ é™¤æˆ–ç§æœ‰çš„ä½œå“ï¼Ÿ

è¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚PixivFlow ä¼šè‡ªåŠ¨è·³è¿‡è¿™äº›ä½œå“å¹¶ç»§ç»­ä¸‹è½½å…¶ä»–ä½œå“ã€‚åœ¨ä¸‹è½½å®Œæˆåä¼šæ˜¾ç¤ºè·³è¿‡çš„ä½œå“æ•°é‡ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](./QUICKSTART.md)
- [é…ç½®æŒ‡å—](./CONFIG.md)
- [ç™»å½•æŒ‡å—](./LOGIN.md)
- [è„šæœ¬æŒ‡å—](./SCRIPTS.md)
- [æ¶æ„æ–‡æ¡£](./ARCHITECTURE.md) - äº†è§£ API æœåŠ¡å™¨å’Œå‰ç«¯é›†æˆ
- [Docker æŒ‡å—](./DOCKER.md)

